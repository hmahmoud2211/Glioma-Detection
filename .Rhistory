theme_minimal()
print(p4)
ggsave("adwg0021_histogram.png", plot = p4)
# Scatterplot of ADWG0050 vs ADWG0021 with regression lines by Sex
p5 <- ggplot(PWD, aes(x = ADWG0021, y = ADWG0050, color = Sex)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
labs(title = "Scatterplot of ADWG0050 vs ADWG0021 by Sex",
x = "ADWG0021 (g/day)", y = "ADWG0050 (g/day)") +
theme_minimal() +
scale_color_manual(values = c("skyblue", "pink"))
print(p5)
# Scatterplot of ADWG0050 vs ADWG0021 with regression lines by Sex
p5 <- ggplot(PWD, aes(x = ADWG0021, y = ADWG0050, color = Sex)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
labs(title = "Scatterplot of ADWG0050 vs ADWG0021 by Sex",
x = "ADWG0021 (g/day)", y = "ADWG0050 (g/day)") +
theme_minimal() +
scale_color_manual(values = c("skyblue", "pink"))
print(p5)
# Histogram for ADWG0021
p4 <- ggplot(PWD, aes(x = ADWG0021)) +
geom_histogram(binwidth = 10, fill = "lightgreen", color = "black") +
labs(title = "Histogram of ADWG0021", x = "ADWG0021 (g/day)", y = "Count") +
theme_minimal()
print(p4)
ggsave("adwg0021_histogram.png", plot = p4)
# Scatterplot of ADWG0050 vs ADWG0021 with regression lines by Sex
p5 <- ggplot(PWD, aes(x = ADWG0021, y = ADWG0050, color = Sex)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
labs(title = "Scatterplot of ADWG0050 vs ADWG0021 by Sex",
x = "ADWG0021 (g/day)", y = "ADWG0050 (g/day)") +
theme_minimal() +
scale_color_manual(values = c("skyblue", "pink"))
print(p5)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(car)
# Scatterplot of ADWG0050 vs ADWG0021 with regression lines by Sex
p5 <- ggplot(PWD, aes(x = ADWG0021, y = ADWG0050, color = Sex)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
labs(title = "Scatterplot of ADWG0050 vs ADWG0021 by Sex",
x = "ADWG0021 (g/day)", y = "ADWG0050 (g/day)") +
theme_minimal() +
scale_color_manual(values = c("skyblue", "pink"))
print(p5)
# Boxplot of ADWG0021 by Treatment
p6 <- ggplot(PWD, aes(x = Treatment, y = ADWG0021, fill = Treatment)) +
geom_boxplot(outlier.shape = 21, outlier.fill = "red", outlier.size = 2) +
labs(title = "Boxplot of ADWG0021 by Treatment",
x = "Treatment", y = "Average Daily Weight Gain (g/day)") +
theme_minimal(base_size = 14) +
theme(legend.position = "none", axis.text.x = element_text(angle = 45, hjust = 1))
print(p6)
ggsave("adwg0021_by_treatment_boxplot.png", plot = p6)
#Treatment A is the better box plot (higher median makes it less sens to outliers)
# Boxplot of ADWG0021 overall
p7 <- ggplot(PWD, aes(y = ADWG0021)) +
geom_boxplot(fill = "coral") +
labs(title = "Boxplot of ADWG0021", y = "ADWG0021 (g/day)") +
theme_minimal()
print(p7)  # Display the plot
ggsave("adwg0021_boxplot.png", plot = p7)
# Scatterplot of ADWG0050 vs ADWG0021 with regression lines by Sex
p5 <- ggplot(PWD, aes(x = ADWG0021, y = ADWG0050, color = Sex)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
labs(title = "Scatterplot of ADWG0050 vs ADWG0021 by Sex",
x = "ADWG0021 (g/day)", y = "ADWG0050 (g/day)") +
theme_minimal() +
scale_color_manual(values = c("skyblue", "pink"))
print(p5)
# Calculate residuals
residuals <- residuals(model)
# Get summary statistics of residuals (Min, 1Q, Median, Mean, 3Q, Max)
summary_residuals <- summary(residuals)
# Print the summary statistics
print(summary_residuals)
cat("\nANOVA Results:\n")
print(summary(anova_result))
cat("Predicted ADWG0021 for Treatment ", desired_treatment, " with 95% confidence interval:\n")
library(DESeq2)
## Install packages once if needed:
install.packages(c("ggplot2", "pheatmap"))
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install(c("DESeq2", "apeglm", "clusterProfiler",
"org.Hs.eg.db", "EnhancedVolcano"))
library(DESeq2)
## Install packages once if needed:
install.packages(c("ggplot2", "pheatmap"))
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install(c("DESeq2", "apeglm", "clusterProfiler",
"org.Hs.eg.db", "EnhancedVolcano"))
library(DESeq2)
## Install packages once if needed:
install.packages("BiocManager")
BiocManager::install("DESeq2")
##-------------------------------
counts <- read.csv("bladder_counts.csv", row.names = 1, check.names = FALSE)
##-------------------------------
## 1. Load counts and metadata
##-------------------------------
counts <- read.csv("G:/RAnalysis/bladder_counts.csv",
row.names = 1,
check.names = FALSE)
coldata <- read.csv("G:/RAnalysis/bladder_sample_sheet.csv",
row.names = 1,
check.names = FALSE)
## Define condition from Sample.Type
## "Primary Tumor" vs "Solid Tissue Normal"
coldata$condition <- ifelse(coldata$Sample.Type == "Primary Tumor",
"Tumor", "Normal")
coldata$condition <- factor(coldata$condition, levels = c("Normal", "Tumor"))
##----------------------------------------
## 2. Basic QC & filtering low-count genes
##----------------------------------------
## Remove very lowly expressed genes
keep <- rowSums(counts) >= 10
counts <- counts[keep, ]
## Quick check of library sizes
libSize <- colSums(counts)
## Check (non-)normality on one sample after log2 transform
log_counts_sample1 <- log2(counts[,1] + 1)
shapiro_res <- shapiro.test(sample(log_counts_sample1, 500))  # subset to 500 genes
print(shapiro_res)
##----------------------------------------
## 3. Run DESeq2 (Tumor vs Normal)
##----------------------------------------
dds <- DESeqDataSetFromMatrix(countData = counts,
colData   = coldata,
design    = ~ condition)
library(DESeq2)
## 3. Run DESeq2 (Tumor vs Normal)
##----------------------------------------
dds <- DESeqDataSetFromMatrix(countData = counts,
colData   = coldata,
design    = ~ condition)
dds <- DESeq(dds)
## Shrink LFCs (more stable estimates)
resLFC <- lfcShrink(dds,
coef = "condition_Tumor_vs_Normal",
type = "apeglm")
BiocManager::install("apeglm")
library(DESeq2)
## Shrink LFCs (more stable estimates)
resLFC <- lfcShrink(dds,
coef = "condition_Tumor_vs_Normal",
type = "apeglm")
res <- as.data.frame(resLFC)
res <- res[order(res$padj), ]
res$symbol <- rownames(res)
## Save full results
write.csv(res, file = "DESeq2_results_full.csv", row.names = TRUE)
write.csv(res, file = "DESeq2_results_full.csv", row.names = TRUE)
getwd()
##----------------------------------------
## 4. Identify DEGs (|log2FC| > log2(1.5), padj < 0.05)
##----------------------------------------
lfc_thr <- log2(1.5)
deg <- subset(res, !is.na(padj) &
abs(log2FoldChange) > lfc_thr &
padj < 0.05)
cat("Number of DEGs:", nrow(deg), "\n")
cat("Upregulated in Tumor:",
sum(deg$log2FoldChange > 0), "\n")
cat("Downregulated in Tumor:",
sum(deg$log2FoldChange < 0), "\n")
write.csv(deg, file = "DESeq2_DEGs_filtered.csv", row.names = TRUE)
##----------------------------------------
## 5. Volcano plot
##----------------------------------------
EnhancedVolcano(res,
lab = res$symbol,
x = "log2FoldChange",
y = "padj",
pCutoff = 0.05,
FCcutoff = lfc_thr,
title = "Tumor vs Normal (TCGA-BLCA)",
subtitle = "DESeq2, |log2FC| > log2(1.5), FDR < 0.05",
xlab = bquote(~Log[2]~ "fold change"),
ylab = bquote(~-Log[10]~ "adjusted p-value")
)
BiocManager::install("EnhancedVolcano")
##----------------------------------------
## 5. Volcano plot
##----------------------------------------
EnhancedVolcano(res,
lab = res$symbol,
x = "log2FoldChange",
y = "padj",
pCutoff = 0.05,
FCcutoff = lfc_thr,
title = "Tumor vs Normal (TCGA-BLCA)",
subtitle = "DESeq2, |log2FC| > log2(1.5), FDR < 0.05",
xlab = bquote(~Log[2]~ "fold change"),
ylab = bquote(~-Log[10]~ "adjusted p-value")
)
library(EnhancedVolcano)
##----------------------------------------
## 5. Volcano plot
##----------------------------------------
EnhancedVolcano(res,
lab = res$symbol,
x = "log2FoldChange",
y = "padj",
pCutoff = 0.05,
FCcutoff = lfc_thr,
title = "Tumor vs Normal (TCGA-BLCA)",
subtitle = "DESeq2, |log2FC| > log2(1.5), FDR < 0.05",
xlab = bquote(~Log[2]~ "fold change"),
ylab = bquote(~-Log[10]~ "adjusted p-value")
)
ggsave("volcano_Tumor_vs_Normal.png", width = 7, height = 6, dpi = 300)
##----------------------------------------
## 6. Variance-stabilized data, heatmap & PCA
##----------------------------------------
vsd <- vst(dds, blind = FALSE)  # or rlog(dds)
## Heatmap of top 50 most variable genes
library(matrixStats)
rv <- rowVars(assay(vsd))
topGenes <- head(order(rv, decreasing = TRUE), 50)
mat <- assay(vsd)[topGenes, ]
mat <- scale(mat)  # Z-score by gene
ann_col <- data.frame(condition = coldata$condition)
rownames(ann_col) <- rownames(coldata)
pheatmap(mat,
annotation_col = ann_col,
show_rownames = TRUE,
show_colnames = FALSE,
clustering_distance_rows = "euclidean",
clustering_distance_cols = "euclidean",
clustering_method = "complete",
main = "Top 50 variable genes")
install.packages("pheatmap")
library(pheatmap)
## Heatmap of top 50 most variable genes
library(matrixStats)
rv <- rowVars(assay(vsd))
topGenes <- head(order(rv, decreasing = TRUE), 50)
mat <- assay(vsd)[topGenes, ]
mat <- scale(mat)  # Z-score by gene
ann_col <- data.frame(condition = coldata$condition)
rownames(ann_col) <- rownames(coldata)
pheatmap(mat,
annotation_col = ann_col,
show_rownames = TRUE,
show_colnames = FALSE,
clustering_distance_rows = "euclidean",
clustering_distance_cols = "euclidean",
clustering_method = "complete",
main = "Top 50 variable genes")
ggsave("heatmap_top50_vst.png", width = 7, height = 7, dpi = 300)
## PCA plot (bonus)
pca_df <- plotPCA(vsd, intgroup = "condition", returnData = TRUE)
percentVar <- round(100 * attr(pca_df, "percentVar"))
ggplot(pca_df, aes(PC1, PC2, color = condition)) +
geom_point(size = 2) +
xlab(paste0("PC1: ", percentVar[1], "% variance")) +
ylab(paste0("PC2: ", percentVar[2], "% variance")) +
ggtitle("PCA of vst-transformed counts") +
theme_bw()
ggsave("PCA_Tumor_vs_Normal.png", width = 6, height = 5, dpi = 300)
## 7. KEGG enrichment of DEGs
##----------------------------------------
## Map gene symbols to Entrez IDs
deg_symbols <- deg$symbol
gene_map <- bitr(deg_symbols,
fromType = "SYMBOL",
toType   = "ENTREZID",
OrgDb    = org.Hs.eg.db)
BiocManager::install("clusterProfiler")
library(clusterProfiler)
##----------------------------------------
## 7. KEGG enrichment of DEGs
##----------------------------------------
## Map gene symbols to Entrez IDs
deg_symbols <- deg$symbol
gene_map <- bitr(deg_symbols,
fromType = "SYMBOL",
toType   = "ENTREZID",
OrgDb    = org.Hs.eg.db)
## Map gene symbols to Entrez IDs
deg_symbols <- deg$symbol
gene_map <- bitr(deg_symbols,
fromType = "SYMBOL",
toType   = "ENTREZID",
OrgDb    = org.Hs.eg.db)
BiocManager::install("org.Hs.eg.db")
library(clusterProfiler)
##----------------------------------------
## 7. KEGG enrichment of DEGs
##----------------------------------------
## Map gene symbols to Entrez IDs
deg_symbols <- deg$symbol
gene_map <- bitr(deg_symbols,
fromType = "SYMBOL",
toType   = "ENTREZID",
OrgDb    = org.Hs.eg.db)
BiocManager::install("clusterProfiler")
##----------------------------------------
## 7. KEGG enrichment of DEGs
##----------------------------------------
## Map gene symbols to Entrez IDs
deg_symbols <- deg$symbol
gene_map <- bitr(deg_symbols,
fromType = "SYMBOL",
toType   = "ENTREZID",
OrgDb    = org.Hs.eg.db)
## Map gene symbols to Entrez IDs
deg_symbols <- deg$symbol
gene_map <- bitr(
deg_symbols,
fromType = "SYMBOL",
toType   = "ENTREZID",
OrgDb    = "org.Hs.eg.db"   # <- STRING, not object
)
head(gene_map)
ekegg <- enrichKEGG(
gene         = gene_map$ENTREZID,
organism     = "hsa",
pAdjustMethod = "BH",
qvalueCutoff  = 0.05
)
head(ekegg, 5)
## Perform KEGG over-representation analysis
ekegg <- enrichKEGG(gene         = gene_map$ENTREZID,
organism     = "hsa",
pAdjustMethod = "BH",
qvalueCutoff = 0.05)
## View top 5 KEGG pathways
head(ekegg, 5)
## Save KEGG table
write.csv(as.data.frame(ekegg),
file = "KEGG_enrichment_DEGs.csv",
row.names = FALSE)
## Optional barplot of KEGG enrichment
barplot(ekegg, showCategory = 20, title = "KEGG enrichment of DEGs")
ggsave("KEGG_barplot_DEGs.png", width = 8, height = 6, dpi = 300)
git add .
git add -A
git status
# Load required libraries
required_packages <- c("DESeq2", "clusterProfiler", "org.Hs.eg.db", "GSVA",
"caret", "dplyr", "tidyr", "xgboost", "randomForest",
"e1071", "glmnet", "nnet",
"Biobase", "GSEABase", "ggplot2")
# Install Bioconductor packages if needed
if (!require("BiocManager", quietly = TRUE)) {
install.packages("BiocManager")
}
for (pkg in required_packages) {
if (!require(pkg, character.only = TRUE, quietly = TRUE)) {
BiocManager::install(pkg)
library(pkg, character.only = TRUE)
}
}
# 1. Load and prepare count data
prepare_data <- function(counts_path, meta_path) {
tryCatch({
# Load count data
counts <- read.csv(counts_path, row.names = 1)
# Load metadata
meta_data <- read.csv(meta_path)
# Clean up cancer type names and convert to factor
meta_data$cancer_type <- as.factor(meta_data$Sample_characteristics_ch1)
# Remove any potential duplicates in sample names
meta_data <- meta_data[!duplicated(meta_data$ID_REF), ]
# Ensure count matrix and metadata match
common_samples <- intersect(colnames(counts), meta_data$ID_REF)
if(length(common_samples) == 0) {
stop("No matching samples between count data and metadata")
}
counts <- counts[, common_samples]
meta_data <- meta_data[meta_data$ID_REF %in% common_samples, ]
# Print summary
cat("\nData summary:\n")
cat("Number of genes:", nrow(counts), "\n")
cat("Number of samples:", ncol(counts), "\n")
cat("\nCancer types distribution:\n")
print(table(meta_data$cancer_type))
return(list(counts = counts,
meta_data = meta_data))
}, error = function(e) {
stop("Error in data preparation: ", conditionMessage(e))
})
}
# Set this to the folder that contains the .gz file
setwd("G:/Glioma Project/Glioma-Detection")
# Install R.utils once (if you don't have it)
if (!requireNamespace("R.utils", quietly = TRUE)) {
install.packages("R.utils")
}
library(R.utils)
# This will create GSE48865_series_matrix.txt in the same folder
gunzip("GSE48865_series_matrix.txt.gz",
overwrite = FALSE,    # set TRUE if you want to overwrite existing .txt
remove = FALSE)       # keep the .gz file
gse_tab <- read.delim(
"GSE48865_series_matrix.txt",
header       = TRUE,
sep          = "\t",
comment.char = "!",   # skip GEO metadata lines
check.names  = FALSE  # keep original column names
)
# Quick checks
dim(gse_tab)          # number of rows and columns
head(gse_tab[, 1:5])  # first few genes Ã— first 5 samples
write.csv(
gse_tab,
file      = "GSE48865_series_matrix.csv",
row.names = FALSE
)
# 1. Set working directory to where the file is located
setwd("G:/Glioma Project/Glioma-Detection")
# 2. Read the NCBI-generated raw count matrix
raw_counts <- read.delim(
"GSE48865_raw_counts_GRCh38.p13_NCBI.tsv.gz",
header = TRUE,
sep = "\t",
comment.char = "#",
check.names = FALSE
)
# 1. Set working directory to where the file is located
setwd("G:/Glioma Project/Glioma-Detection")
# 2. Read the NCBI-generated raw count matrix
raw_counts <- read.delim(
"GSE48865_raw_counts_GRCh38.p13_NCBI.tsv.gz",
header = TRUE,
sep = "\t",
comment.char = "#",
check.names = FALSE
)
# 1. Set working directory to where the file is located
setwd("G:/Glioma Project/Glioma-Detection")
# 2. Read the NCBI-generated raw count matrix
raw_counts <- read.delim(
"GSE48865_raw_counts_GRCh38.p13_NCBI(1).tsv.gz",
header = TRUE,
sep = "\t",
comment.char = "#",
check.names = FALSE
)
# 1. Set working directory to where the file is located
setwd("G:/Glioma Project/Glioma-Detection")
# 2. Read the NCBI-generated raw count matrix
raw_counts <- read.delim(
"GSE48865_raw_counts_GRCh38.p13_NCBI (1).tsv.gz",
header = TRUE,
sep = "\t",
comment.char = "#",
check.names = FALSE
)
# 3. Inspect
dim(raw_counts)
head(raw_counts[, 1:5])
# 4. Save as CSV
write.csv(
raw_counts,
file = "GSE48865_raw_counts_GRCh38.csv",
row.names = FALSE
)
# Load required libraries
required_packages <- c("DESeq2", "clusterProfiler", "org.Hs.eg.db", "GSVA",
"caret", "dplyr", "tidyr", "xgboost", "randomForest",
"e1071", "glmnet", "nnet",
"Biobase", "GSEABase", "ggplot2")
# Install Bioconductor packages if needed
if (!require("BiocManager", quietly = TRUE)) {
install.packages("BiocManager")
}
for (pkg in required_packages) {
if (!require(pkg, character.only = TRUE, quietly = TRUE)) {
BiocManager::install(pkg)
library(pkg, character.only = TRUE)
}
}
# Load required libraries
required_packages <- c("DESeq2", "clusterProfiler", "org.Hs.eg.db", "GSVA",
"caret", "dplyr", "tidyr", "xgboost", "randomForest",
"e1071", "glmnet", "nnet",
"Biobase", "GSEABase", "ggplot2")
# Install Bioconductor packages if needed
if (!require("BiocManager", quietly = TRUE)) {
install.packages("BiocManager")
}
for (pkg in required_packages) {
if (!require(pkg, character.only = TRUE, quietly = TRUE)) {
BiocManager::install(pkg)
library(pkg, character.only = TRUE)
}
}
# Load required libraries
required_packages <- c("DESeq2", "clusterProfiler", "org.Hs.eg.db", "GSVA",
"caret", "dplyr", "tidyr", "xgboost", "randomForest",
"e1071", "glmnet", "nnet",
"Biobase", "GSEABase", "ggplot2")
# Install Bioconductor packages if needed
if (!require("BiocManager", quietly = TRUE)) {
install.packages("BiocManager")
}
for (pkg in required_packages) {
if (!require(pkg, character.only = TRUE, quietly = TRUE)) {
BiocManager::install(pkg)
library(pkg, character.only = TRUE)
}
}
